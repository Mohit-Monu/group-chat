<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../css/signned.css">
</head>

<body>
    <div class="head">
        <h2>Welcome to chat app</h2>
        <a href="./sign_in.html" class="log">Log out</a>
    </div>
    <hr>
    <br>
    <div class="chating" id="boxx">
        <!-- <div class="chatother">
            <h3 class="textothers">Ram:Hi There</h3>
        </div>
        <div class="chatother">
            <h3 class="textothers">Ram:Hi There</h3>
        </div>
        <div class="chatother">
            <h3 class="textothers">Ram:Hi There</h3>
        </div>
        <div class="chatother">
            <h3 class="textothers">Ram:Hi There</h3>
        </div>
        <div class="chatyou">
            <h3 class="textyou">You:Hi There</h3>
        </div> -->
    </div>
    <div class="chat">
        <form action="">
            <input type="text" id="messag" placeholder="plese write massage here" required>
            <button class="sendbutt" id="sendbutt" type="submit">
                Send
            </button>
        </form>
    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    const token = localStorage.getItem("TOKEN")
    document.getElementById('sendbutt').addEventListener("click", sendmess)
    window.addEventListener("DOMContentLoaded", async () => {
        await pageloader();
    })
    async function pageloader() {
        try {
            const config = {
                url: "http://localhost:3000/group/getsmss",
                method: "GET",
                headers: { "token": token }
            }
            const masages = await axios(config);
            const messages = masages.data.messages;
            const userid = masages.data.userId;
            loadexp(messages, userid)
        } catch (err) {
            console.log(err)
        }
    }
    async function sendmess() {
        try {
            var message = document.getElementById('messag').value
            const config = {
                method: "POST",
                url: "http://localhost:3000/group/sendmess",
                data: {
                    'message': message
                },
                headers: {
                    "token": token
                }
            }
            await axios(config)
        } catch (err) {
            console.log(err)
        }
        await deleteall();
        await pageloader()
    }
    async function loadexp(messages, userid) {
        const box = document.getElementById("boxx")
        messages.forEach(element => {
            const div = document.createElement("div");
            const h3 = document.createElement("h3");
            if (element.userId == userid) {
                div.className = "chatyou";
                h3.className = "textyou";
                h3.innerHTML = "You" + " - " + element.massage
            } else {
                div.className = "chatother";
                h3.className = "textothers";
                h3.innerHTML = element.name + " - " + element.massage
            }
            box.appendChild(div);
            div.appendChild(h3)
        });
        box.scrollTop = box.scrollHeight - box.clientHeight;

    }
    function deleteall(){
        var box = document.getElementById('boxx')
        box.innerHTML=""
    }
</script>

</html>